{% extends '../template/CSO_master.html' %}
{% import '../template/tags_macro.html' as tag %}

{%block page_title%}APS - Activity Checking{%-endblock%}

{%block style%}
    {{super()}}
    <!-- Bootstrap Core CSS -->
    {{tag.style('/plugins/bower_components/datatables/jquery.dataTables.min.css')}}
    {{tag.style('/plugins/bower_components/nestable/nestable.css')}}
    {{tag.style('https://cdn.datatables.net/buttons/1.2.2/css/buttons.dataTables.min.css')}}
    {{tag.style('https://cdnjs.cloudflare.com/ajax/libs/nestable2/1.5.0/jquery.nestable.min.CSS')}}
    <!-- Menu CSS -->
    {{tag.style('/plugins/bower_components/sidebar-nav/dist/sidebar-nav.min.css')}}
    <!-- animation CSS -->
    {{tag.style('/css/animate.css')}}
    <!--alerts CSS -->
    {{tag.style('https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/6.9.1/sweetalert2.min.css')}}
    <!-- Custom CSS -->
    {{tag.style('/plugins/bower_components/custom-select/custom-select.css')}}
    {{tag.style('/plugins/bower_components/bootstrap-select/bootstrap-select.min.css')}}
    {{tag.style('/plugins/bower_components/bootstrap-datepicker/bootstrap-datepicker.min.css')}}
    
    {{tag.style('/css/style.css')}}
    {{tag.style('/css/custom.css')}}
    {{tag.style('/css/doms.css')}}
    <!-- color CSS -->
    {{tag.style('/css/colors/default.css', id='theme')}}

    <style type="text/css">
        .remove:{
            color: yellow
        }
        .sweet-alert fieldset {

            display: none;
        }
        .tabs-style-linebox nav a:hover{
            color: #00c292;
            text-decoration-color:#00c292 !important;
        }
        a:focus::after,
        .tabs-style-linebox nav a:hover::after,
        .tabs-style-linebox nav li.tab-current a::after{
            background: #00c292;
            text-decoration-color:#00c292 !important;
        }
        .tabs-style-linebox nav a:focus::after,
        .tabs-style-linebox nav a:hover::after,
        .tabs-style-linebox nav li.tab-current a::after{
            background: #00c292;
            text-decoration-color:#00c292 !important;
        }
        .custom-class:focus { overflow: hidden; }
    </style>
{%endblock%}

{%block defer_script%}
    {{super()}}
    <!-- Bootstrap Core JavaScript -->
    {{tag.javascript('/bootstrap/dist/js/tether.min.js', true)}}
    <!-- Menu Plugin JavaScript -->
    {{tag.javascript('/plugins/bower_components/sidebar-nav/dist/sidebar-nav.min.js', true)}}
    <!--slimscroll JavaScript -->
    {{tag.javascript('/js/jquery.slimscroll.js', true)}}
    <!--Wave Effects -->
    {{tag.javascript('/js/waves.js', true)}}
    <!-- Custom Theme JavaScript -->
    {{tag.javascript('/js/custom.min.js', true)}}
    {{tag.javascript('/js/cbpFWTabs.js', true)}}
    <!-- tabs-->
    {{tag.javascript('/plugins/bower_components/datatables/jquery.dataTables.min.js', true)}}
    <!-- Sweet-Alert  -->
    {{tag.javascript('/plugins/bower_components/sweetalert/sweetalert.min.js', true)}}
    <!--Style Switcher -->
    {{tag.javascript('/plugins/bower_components/styleswitcher/jQuery.style.switcher.js', true)}}

    {{tag.javascript('https://cdn.datatables.net/buttons/1.2.2/js/dataTables.buttons.min.js', true)}}
    {{tag.javascript('https://cdn.datatables.net/buttons/1.2.2/js/buttons.flash.min.js', true)}}
    {{tag.javascript('https://cdnjs.cloudflare.com/ajax/libs/jszip/2.5.0/jszip.min.js', true)}}
    {{tag.javascript('https://cdn.rawgit.com/bpampuch/pdfmake/0.1.18/build/pdfmake.min.js', true)}}
    {{tag.javascript('https://cdn.rawgit.com/bpampuch/pdfmake/0.1.18/build/vfs_fonts.js', true)}}
    {{tag.javascript('https://cdn.datatables.net/buttons/1.2.2/js/buttons.html5.min.js', true)}}
    {{tag.javascript('https://cdn.datatables.net/buttons/1.2.2/js/buttons.print.min.js', true)}}
    {{tag.javascript('https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/6.9.1/sweetalert2.min.js', true)}}
    {{tag.javascript('https://cdnjs.cloudflare.com/ajax/libs/nestable2/1.5.0/jquery.nestable.min.js', true)}}
    {{tag.javascript('/plugins/bower_components/custom-select/custom-select.min.js', true)}}
    {{tag.javascript('/plugins/bower_components/bootstrap-select/bootstrap-select.min.js', true)}}

    <!-- Page Scripts -->
    {{tag.javascript('/js/system/AJAX_CSRF.js', true)}}
    
    {{tag.javascript('/plugins/bower_components/bootstrap-datepicker/bootstrap-datepicker.min.js', true)}}
    {{tag.javascript('/plugins/bower_components/bootstrap-daterangepicker/daterangepicker.js', true)}}
    {{tag.javascript('/js/APS/ActivityChecking.js', true)}}
    <!-- /Page Scripts -->
{%endblock%}

{%block body_preloader%}
    <div class="preloader">
        <svg class="circular" viewBox="25 25 50 50">
            <circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="2" stroke-miterlimit="10" />
        </svg>
    </div>
{%endblock%}

{%block content%}
    <div id="doc" ct="{{activity}}" class="row white-box" limit="{{limit+1}}" ds="{{dates}}">
    <div class="col-md-4 col-xs-12 ">
        <div class="white-box ">
            <div class="text-center"> <h1>{{projectProposal.strategies}}</h1> </div>
            <p class="text-center">{{projectProposal.orgname}}</p>
            <div class="">
                <!-- .row -->
                <div class="row text-center ">
                    <div class="col-md-6 b-r"><strong>Type</strong>
                        <p>{{projectProposal.type}}</p>
                    </div>
                    <div class="col-md-6"><strong>Nature</strong>
                        <p>{{projectProposal.nature}}</p>
                    </div>
                </div>
                <!-- /.row -->
                <hr>
                <!-- .row -->
                <div class="row text-center m-t-10">
                    <div class="col-md-6 b-r"><strong>Venue</strong>
                        <p>{{projectProposal.venue}}</p>
                    </div>
                    <div class="col-md-6"><strong>ENMP / ENP</strong>
                        <p>{{projectProposal.enmp}} / {{projectProposal.enp}}</p>
                    </div>
                </div>
                <!-- /.row -->
                <hr>
                <div class="row text-center m-t-10">
                    <div class="col-md-12">
                        <p><strong>Date</strong></p>


                        {% for date, programs in programDesign | groupby('date') %}
                            <p>{{date}}</p>
                        {% endfor %}
                       
                       

                    </div>
                    {%if projectProposal.rescheddates|length and projectProposal.status == 6%}
                        
                        <div class="col-md-12">
                            <p><strong>Reschedule Date /s</strong></p>


                                {%for date in projectProposal.rescheddates  %}
                                    <p>
                                    
                                    {%filter replace('00:00:00 GMT+0800 (+08)','')%}
                                        {{date}}
                                    {%endfilter%}
                                    </p>
                                {%endfor%}
                            
                            
                        </div>
                    {%endif%}

                    {% if  projectProposal.reschedrejectreason|length > 1  %}
                        <div class="col-md-12">
                            <p><strong style="color:#FB9678">Rescheduled Denied!</strong></p>
                            <p style="color:#FB9678">Reason : {{projectProposal.reschedrejectreason}}</p>
                        </div>
                    {%endif%}

                    {% if resched <= 0  and projectProposal.status == 3 and isProjecthead%}
                        <div class="col-md-12">
                            <button type="button" class="btn btn-default" id='reschedule'>Reschedule</button>    
                        </div>
                        
                    {%endif%}
                    
                </div>
                <hr>
                <!-- .row -->
                <div class="row text-center m-t-10">
                    <div class="col-md-12">
                        <p><strong>Project Heads</strong></p>


                        {% for head in projectHeads %}                            
                            <p>{{head.name}}</p>
                            <p>{{head.contactnumber}}</p>
                        {% endfor %}

                    </div>
                </div>
                <hr>


            </div>
        </div>
    </div>
    <div class="col-md-8 col-xs-12" style="border-left: rgba(120,130,140,13) solid 1px">
        <div class="white-box"  style="padding: 25px 0px 0px 0px">

            <div class="sttabs tabs-style-linebox ">
                <nav>
                    <ul>
                        <li><a href="#section-linebox-1"><span>Details</span></a></li>
                        <li><a href="#section-linebox-2"><span>Schedule</span></a></li>
                        {%if withExpense%}
                        <li><a href="#section-linebox-3"><span>Funding</span></a></li>
                        {%endif%}
                        <li><a href="#section-linebox-5"><span>Attachment</span></a></li>
                        <li><a href="#section-linebox-6"><span>Signatories</span></a></li>

                    </ul>
                </nav>
                <div class="content-wrap text-center">
                    <section id="section-linebox-1">

                        <div class="white-box text-left">

                            <h4 class="text-left">I. Objectives</h4>
                            <hr>
                            <ul class="  text-left">



                                {% for objective in projectProposal.objectives %}


                                    <li>{{objective}}</li>
                                {% endfor %}

                            </ul>
                            <!-- <div class="row">
                                <div class="col-md-3 col-xs-6 b-r"> <strong>Full Name</strong>
                                    <br>
                                    <p class="text-muted">Johnathan Deo</p>
                                </div>
                                <div class="col-md-3 col-xs-6 b-r"> <strong>Mobile</strong>
                                    <br>
                                    <p class="text-muted">(123) 456 7890</p>
                                </div>
                                <div class="col-md-3 col-xs-6 b-r"> <strong>Email</strong>
                                    <br>
                                    <p class="text-muted">johnathan@admin.com</p>
                                </div>
                                <div class="col-md-3 col-xs-6"> <strong>Location</strong>
                                    <br>
                                    <p class="text-muted">London</p>
                                </div>
                            </div> -->
                            <h4 class="m-t-30 text-left">II. Brief Context</h4>
                            <hr>



                            <p class="m-t-30">
                            {{projectProposal.context1}}
                            </p>

                            <p class="m-t-30">
                            {{projectProposal.context2}}
                            </p>

                            <p class="m-t-30">
                            {{projectProposal.context3}}
                            </p>


                        </div>
                    </section>
                    <section id="section-linebox-2 text-left">
                        <div class="white-box">
                             <h4 class="m-t-30 text-left">III. Program Design</h4>
                            <hr>


                            {% for date, programs in programDesign | groupby('date') %}
                                 <div class="text-center">
                                        <h3>{{date}}</h3>
                                    </div>
                                    <table class="table  text-left table-striped">
                                        <thead>
                                            <th>Time </th>

                                            <th>Activity</th>
                                            <th>Description</th>
                                            <th>Person-In-Charge</th>
                                        </thead>
                                        <tbody>
                                        {%for program in programs%}
                                            <tr>
                                                <td >{{program.starttime}}-{{program.endtime}}</td>
                                                <td >{{program.activity}}</td>
                                                <td >{{program.activitydescription}}</td>
                                                <td >{{program.firstname}} {{program.lastname}}</td>
                                            </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                    <br/>
                            {% endfor %}

                        </div>
                    </section>
                    {%if withExpense%}
                    <section id="section-linebox-3">
                        <div class="white-box">
                            <h4 class="text-left">IV. Source of Funds</h4>
                            <hr>
                            <br/>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="col-md-6 col-xs-12 text-left">
                                        <strong>Organization funds:</strong>
                                    </div>
                                    <div class="col-md-6 col-xs-12">
                                        {{projectProposal.sourcefundorganizational | round(2)}}
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="col-md-6 col-xs-12 text-left">
                                        <strong>Participants Fee:</strong>
                                    </div>
                                    <div class="col-md-6 col-xs-12">
                                        {{projectProposal.sourcefundparticipantfee | round(2)}}
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="col-md-6 col-xs-12 text-left">
                                        <strong>Others:</strong>
                                    </div>
                                    <div class="col-md-6 col-xs-12">
                                        {{projectProposal.sourcefundother | round(2)}}
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="col-md-6 col-xs-12 text-right">
                                        <strong>Total:</strong>
                                    </div>
                                    <div class="col-md-6 col-xs-12">
                                        {{(projectProposal.sourcefundorganizational | round(2))+(projectProposal.sourcefundparticipantfee | round(2))+(projectProposal.sourcefundother | round(2))}}
                                    </div>
                                </div>

                            </div>
                            <br/>
                            <h4 class="text-left">V. Organizational Funds</h4>
                            <hr>
                            <br/>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="col-md-6 col-xs-12 text-left">
                                        <strong>Operational Funds:</strong>
                                    </div>
                                    <div class="col-md-6 col-xs-12">
                                        {{projectProposal.accumulatedoperationalfunds | round(2)}}
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="col-md-6 col-xs-12 text-left">
                                        <strong>Depository Funds:</strong>
                                    </div>
                                    <div class="col-md-6 col-xs-12">
                                        {{projectProposal.accumulateddepositoryfunds | round(2)}}
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="col-md-6 col-xs-12 text-left">
                                        <strong>Others:</strong>
                                    </div>
                                    <div class="col-md-6 col-xs-12">
                                        {{projectProposal.organizationfundothersource | round(2)}}
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="col-md-6 col-xs-12 text-right">
                                        <strong>Total Cash for Disbursement:</strong>
                                    </div>
                                    <div class="col-md-6 col-xs-12">
                                        {% set disbursement = ((projectProposal.accumulatedoperationalfunds | round(2))+(projectProposal.accumulateddepositoryfunds | round(2))+(projectProposal.organizationfundothersource | round(2))) %}
                                        {{disbursement | round(2)}}
                                    </div>
                                </div>
                                <div> &nbsp</div>
                                <div class="col-md-12">
                                    <div class="col-md-6 col-xs-12 text-left">
                                        <strong>Total Projected Expenses:</strong>
                                    </div>
                                    <div class="col-md-6 col-xs-12">
                                        {{projectProposal.sourcefundorganizational | round(2)}}
                                    </div>
                                </div>
                                 <div class="col-md-12">
                                    <div class="col-md-6 col-xs-12 text-right">
                                        <strong>Remaining Balance:</strong>
                                    </div>
                                    <div class="col-md-6 col-xs-12">
                                        {{(disbursement | round(2))-(projectProposal.sourcefundorganizational | round(2))}}
                                    </div>
                                </div>


                            </div>
                            <br/>
                            <h4 class="text-left">VI. Revenue and Expense Table</h4>
                            <hr>
                            <br/>
                            {%if withRevenue%}
                            <table class="table bg">
                                <thead>

                                    <tr>
                                        <th class="text-center"  style="border-top: white solid 0px "  >Material</th>
                                        <th class="text-center" style="border-top: white solid 0px ">Quantity</th>
                                        <th class="text-center" style="border-top: white solid 0px ">Selling Price</th>
                                        <th class="text-right" style="border-top: white solid 0px ">&nbsp</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% set totalrevenue = 0 %}
                                    {% for income in projectedIncome %}
                                        <tr>
                                            <td>
                                                {{income.item}}
                                            </td>
                                            <td>
                                                {{income.quantity}}
                                            </td>
                                            <td>
                                                {{income.sellingprice | round(2)}}
                                            </td>
                                            <td  class="text-right">
                                                {% set price = ((income.quantity)*(income.sellingprice | round(2))) %}
                                                {{price | round(2)}}
                                                {% set totalrevenue = totalrevenue + (price | round(2)) %}
                                            </td>
                                        </tr>
                                    {% endfor %}

                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td class="text-right text-success" colspan="3"><strong>Total Revenue</strong></td>
                                        <td  class="text-right">{{totalrevenue | round(2)}}</td>
                                    </tr>
                                </tfoot>
                            </table>
                            {%endif%}
                            <br/>
                            <table class="table bg">
                                <thead>

                                    <tr>
                                        <th class="text-center"  style="border-top: white solid 0px "  >Material</th>
                                        <th class="text-center" style="border-top: white solid 0px ">Quantity</th>
                                        <th class="text-center" style="border-top: white solid 0px ">Unit Cost</th>
                                        <th class="text-right" style="border-top: white solid 0px ">&nbsp</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% set totalexpense = 0 %}
                                    {% for expense in expenses %}
                                    <tr>
                                        <td>
                                            {{expense.material}}
                                        </td>
                                        <td>
                                            {{expense.quantity}}
                                        </td>
                                        <td>
                                            {{expense.unitcost | round(2)}}
                                        </td>
                                        <td  class="text-right">
                                            {% set price = ((expense.quantity)*(expense.unitcost | round(2))) %}
                                            {{price | round(2)}}
                                            {% set totalexpense = totalexpense + (price | round(2)) %}
                                        </td>
                                    </tr>
                                   {% endfor %}

                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td class="text-right text-danger" colspan="3"><strong>Total Expense</strong></td>
                                        <td  class="text-right">{{totalexpense | round(2)}}</td>
                                    </tr>
                                     {%if withRevenue%}
                                     <tr>
                                        <td class="text-right text-success" colspan="3"  style="border-top: white solid 0px "><strong>Total Income </strong></td>
                                        <td  class="text-right" style="border-top: white solid 0px ">
                                            {% set totalincome =  ((totalrevenue | round(2)) - (totalexpense | round(2))) %}
                                            {{totalincome | round(2)}}
                                        </td>
                                    </tr>
                                    {%endif%}
                                </tfoot>
                            </table>
                            <br/>



                        </div>
                    </section>
                    {%endif%}
                    <!-- OLD THING -->
                    <!-- <section id="section-linebox-5" style="display: block;visibility:hidden;"> -->
                    <section id="section-linebox-5" >
                     <h4 class="text-left">VII. Attachments</h4>
                            <hr>

                        {% for att in attachment %}

                         <div class="white-box"  >
                            <h4 class="text-left">{{att.name}}</h4>
                            <hr>
                            <br/>
                            <iframe src = "/ViewerJS/#../upload/preacts/{{att.idnumber}}/{{att.filename}}"  width='400' height='300' allowfullscreen webkitallowfullscreen></iframe>
                            <!-- <a href="/ViewerJS/#../upload/preacts/{{att.idnumber}}/{{att.filename}}">LINK</a> -->
                        </div>

                        {% endfor %}
                    </section>


                    <section id="section-linebox-6">
                       <div class="white-box">
                           <h4 class="m-t-30 text-left">VIII. Signatories</h4>

                           <hr />
                           <div class="comment-center">
                           {% for signatory in signatories %}
                                <div class="comment-body col-md-12 text-center">
                                    <div class="user-img">  </div>
                                    <div class="mail-contnet text-center">

                                    <h5 class="text-center">
                                        {%if signatory.status =='Unsigned' %}
                                        <span class="label label-rounded label-default text-black pull-left" style="color:black">{{signatory.status}}</span>
                                        {%elif  signatory.status == 'Approved'%}
                                        <span class="label label-rounded label-success pull-left">{{signatory.status}}</span>
                                        {%elif  signatory.status == 'Pend'%}
                                        <span class="label label-rounded label-warning pull-left">{{signatory.status}}</span>
                                        {%elif  signatory.status == 'Denied'%}
                                        <span class="label label-rounded label-danger pull-left">{{signatory.status}}</span>
                                        {%endif%}

                                        <span class="time pull-right">
                                        {% if(signatory.datesigned and signatory.status == 'Approved')%}
                                            {{signatory.datesigned}}
                                        {% else %}
                                            N/A
                                        {% endif %}
                                        </span>

                                    </h5>
                                    <h5>{{signatory.signatoryname}}</h5>
                                    <p>{{signatory.type}}</p>
                                    <p class="break">{%if(signatory.status == 'Approved')%}
                                        {{signatory.digitalsignature}}
                                        {%endif%}</p>
                                    </div>
                                </div>

                            {% endfor %}
                           </div>
                           <hr />
                           <br />
                       </div>
                   </section>
                </div>
                <!-- /content -->
            </div>
        </div>
    </div>
</div>
{%endblock%}
